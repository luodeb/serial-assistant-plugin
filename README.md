# ä¸²å£è°ƒè¯•åŠ©æ‰‹æ’ä»¶

## ç®€ä»‹

ä¸²å£è°ƒè¯•åŠ©æ‰‹æ’ä»¶æ˜¯ä¸€ä¸ªåŸºäº Rust å’Œ Tokio çš„é«˜æ€§èƒ½ä¸²å£é€šä¿¡æ’ä»¶ï¼Œä¸“ä¸º Tauri èŠå¤©å®¢æˆ·ç«¯é¡¹ç›®è®¾è®¡ã€‚å®ƒæä¾›äº†å®Œæ•´çš„ä¸²å£é€šä¿¡åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç«¯å£ç®¡ç†ã€æ•°æ®æ”¶å‘ã€é…ç½®ç®¡ç†å’Œå®æ—¶ç›‘æ§ã€‚

## ç‰¹æ€§

- ğŸ”Œ **å¤šç«¯å£æ”¯æŒ**: è‡ªåŠ¨å‘ç°å’Œç®¡ç†ç³»ç»Ÿä¸­çš„æ‰€æœ‰ä¸²å£è®¾å¤‡
- âš¡ **å¼‚æ­¥é«˜æ€§èƒ½**: åŸºäº Tokio å¼‚æ­¥è¿è¡Œæ—¶ï¼Œæ”¯æŒé«˜å¹¶å‘ä¸²å£æ“ä½œ
- ğŸ“Š **å®æ—¶ç›‘æ§**: æä¾›è¿æ¥çŠ¶æ€ã€æ•°æ®ç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒæ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€åœæ­¢ä½ã€æ ¡éªŒä½ç­‰å®Œæ•´é…ç½®
- ğŸ“ **å¤šç§æ ¼å¼**: æ”¯æŒæ–‡æœ¬ã€åå…­è¿›åˆ¶ã€äºŒè¿›åˆ¶æ•°æ®æ ¼å¼
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ¢å¤æœºåˆ¶
- ğŸ”„ **çƒ­æ’æ‹”**: æ”¯æŒè®¾å¤‡çš„çƒ­æ’æ‹”æ£€æµ‹å’Œè‡ªåŠ¨é‡è¿

## æ¶æ„è®¾è®¡

```
æ’ä»¶æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ UI å±‚                                â”‚
â”‚              (SerialDebugger.vue)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Plugin Messages
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ’ä»¶æ¥å£å±‚                                   â”‚
â”‚            (plugin-interfaces)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ API Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ä¸²å£è°ƒè¯•åŠ©æ‰‹æ’ä»¶                                â”‚
â”‚          (SerialDebugAssistant)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”œâ”€â”€ config.rs      (é…ç½®ç®¡ç†)                              â”‚
â”‚  â”œâ”€â”€ serial_client.rs (ä¸²å£å®¢æˆ·ç«¯)                          â”‚
â”‚  â”œâ”€â”€ error.rs       (é”™è¯¯å¤„ç†)                              â”‚
â”‚  â””â”€â”€ lib.rs         (æ’ä»¶å…¥å£)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ System Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 åº•å±‚ä¸²å£åº“                                   â”‚
â”‚          (tokio-serial + serialport)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ ˆ

- **è¯­è¨€**: Rust 2021 Edition
- **å¼‚æ­¥è¿è¡Œæ—¶**: Tokio 1.45.1
- **ä¸²å£åº“**: 
  - `serialport 4.7.2` - è·¨å¹³å°ä½çº§ä¸²å£åº“
  - `tokio-serial 5.4.5` - Tokio å¼‚æ­¥ä¸²å£å®ç°
- **åºåˆ—åŒ–**: serde + serde_json
- **é”™è¯¯å¤„ç†**: thiserror + anyhow
- **é…ç½®ç®¡ç†**: toml
- **æ—¥å¿—**: log

## å®‰è£…å’Œæ„å»º

### å‰ç½®è¦æ±‚

- Rust 1.59.0+
- ç³»ç»Ÿä¸²å£é©±åŠ¨æ”¯æŒ

### æ„å»ºæ­¥éª¤

```bash
# è¿›å…¥æ’ä»¶ç›®å½•
cd plugins/serial-debug-assistant

# æ„å»ºæ’ä»¶
cargo build --release

# è¿è¡Œæµ‹è¯•
cargo test

# æ£€æŸ¥ä»£ç 
cargo clippy
```

### ä¾èµ–è¯´æ˜

æ’ä»¶ä¾èµ–çš„ä¸»è¦ crateï¼š

```toml
[dependencies]
# ä¸²å£é€šä¿¡åº“
serialport = "4.7.2"           # è·¨å¹³å°ä¸²å£åº“
tokio-serial = "5.4.5"         # Tokio å¼‚æ­¥ä¸²å£

# æ ¸å¿ƒä¾èµ–
tokio = { version = "1.45.1", features = ["full"] }
serde = { version = "1", features = ["derive"] }
serde_json = "1"
toml = "0.8"

# æ’ä»¶æ¥å£
plugin-interfaces = { path = "../../plugin-interfaces" }

# é”™è¯¯å¤„ç†
anyhow = "1.0"
thiserror = "1.0"
```

## API æ¥å£

### å¯ç”¨ç«¯å£ç®¡ç†

```rust
// è·å–å¯ç”¨ç«¯å£åˆ—è¡¨
RequestType::GetPorts
ResponseType::Ports { ports: Vec<PortInfo> }

// åˆ·æ–°ç«¯å£åˆ—è¡¨
RequestType::RefreshPorts
ResponseType::Ports { ports: Vec<PortInfo> }
```

### è¿æ¥ç®¡ç†

```rust
// è¿æ¥ä¸²å£
RequestType::Connect { config: SerialConfig }
ResponseType::Connected { success: bool, message: String }

// æ–­å¼€è¿æ¥
RequestType::Disconnect
ResponseType::Disconnected { success: bool, message: String }

// è·å–è¿æ¥çŠ¶æ€
RequestType::GetStatus
ResponseType::Status { status: ConnectionStatus }
```

### æ•°æ®é€šä¿¡

```rust
// å‘é€æ•°æ®
RequestType::SendData { data: Vec<u8>, format: DataFormat }
ResponseType::DataSent { success: bool, bytes: usize, message: String }

// æ¥æ”¶æ•°æ® (å¼‚æ­¥æ¨é€)
ResponseType::DataReceived { packet: DataPacket }
```

### é…ç½®å’Œç»Ÿè®¡

```rust
// è·å–é…ç½®
RequestType::GetConfig
ResponseType::Config { config: SerialConfig }

// è·å–ç»Ÿè®¡ä¿¡æ¯
RequestType::GetStatistics
ResponseType::Statistics { stats: Statistics }
```

## é…ç½®é€‰é¡¹

### ä¸²å£é…ç½® (SerialConfig)

```rust
pub struct SerialConfig {
    pub port: String,                    // ç«¯å£åç§°
    pub baud_rate: u32,                 // æ³¢ç‰¹ç‡
    pub data_bits: u8,                  // æ•°æ®ä½ (5-8)
    pub stop_bits: u8,                  // åœæ­¢ä½ (1-2)
    pub parity: ParityMode,             // æ ¡éªŒä½
    pub flow_control: FlowControl,      // æµæ§åˆ¶
    pub read_timeout: Option<Duration>, // è¯»å–è¶…æ—¶
    pub write_timeout: Option<Duration>,// å†™å…¥è¶…æ—¶
}
```

### æ”¯æŒçš„é…ç½®å€¼

- **æ³¢ç‰¹ç‡**: 9600, 19200, 38400, 57600, 115200, 230400, 460800, 921600
- **æ•°æ®ä½**: 5, 6, 7, 8
- **åœæ­¢ä½**: 1, 2
- **æ ¡éªŒä½**: None (æ— ), Odd (å¥‡), Even (å¶), Mark (æ ‡è®°), Space (ç©ºæ ¼)
- **æµæ§åˆ¶**: None (æ— ), Software (è½¯ä»¶), Hardware (ç¡¬ä»¶)

## æ•°æ®æ ¼å¼

### æ”¯æŒçš„æ•°æ®æ ¼å¼

```rust
pub enum DataFormat {
    Text,    // æ–‡æœ¬æ ¼å¼ - UTF-8 å­—ç¬¦ä¸²
    Hex,     // åå…­è¿›åˆ¶æ ¼å¼ - "48 65 6C 6C 6F"
    Binary,  // äºŒè¿›åˆ¶æ ¼å¼ - "01001000 01100101"
}
```

### æ•°æ®åŒ…ç»“æ„

```rust
pub struct DataPacket {
    pub timestamp: String,           // æ—¶é—´æˆ³
    pub direction: DataDirection,    // ä¼ è¾“æ–¹å‘ (Sent/Received)
    pub data: Vec<u8>,              // åŸå§‹æ•°æ®
    pub format: DataFormat,         // æ•°æ®æ ¼å¼
    pub display_text: String,       // æ˜¾ç¤ºæ–‡æœ¬
}
```

## ç»Ÿè®¡ä¿¡æ¯

```rust
pub struct Statistics {
    pub bytes_sent: u64,            // å‘é€å­—èŠ‚æ•°
    pub bytes_received: u64,        // æ¥æ”¶å­—èŠ‚æ•°
    pub packets_sent: u64,          // å‘é€åŒ…æ•°
    pub packets_received: u64,      // æ¥æ”¶åŒ…æ•°
    pub errors_count: u64,          // é”™è¯¯æ¬¡æ•°
    pub connection_time: Option<Duration>, // è¿æ¥æ—¶é•¿
    pub last_activity: Option<Instant>,   // æœ€åæ´»åŠ¨æ—¶é—´
}
```

## é”™è¯¯å¤„ç†

### é”™è¯¯ç±»å‹

```rust
pub enum SerialError {
    ConnectionFailed(String),       // è¿æ¥å¤±è´¥
    InvalidConfiguration(String),   // é…ç½®æ— æ•ˆ
    SendFailed(String),            // å‘é€å¤±è´¥
    ReceiveFailed(String),         // æ¥æ”¶å¤±è´¥
    PortEnumerationFailed(String), // ç«¯å£æšä¸¾å¤±è´¥
    DataFormatError(String),       // æ•°æ®æ ¼å¼é”™è¯¯
    Timeout(String),               // è¶…æ—¶é”™è¯¯
    IoError(std::io::Error),       // IOé”™è¯¯
    SerialPortError(serialport::Error), // ä¸²å£åº“é”™è¯¯
    TaskCancelled,                 // ä»»åŠ¡å–æ¶ˆ
    PluginError(String),           // æ’ä»¶é”™è¯¯
}
```

### é”™è¯¯å“åº”

æ‰€æœ‰é”™è¯¯éƒ½ä¼šè¢«è½¬æ¢ä¸ºç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ï¼š

```rust
pub struct ErrorResponse {
    pub error_type: String,    // é”™è¯¯ç±»å‹
    pub message: String,       // é”™è¯¯æ¶ˆæ¯
    pub details: Option<String>, // è¯¦ç»†ä¿¡æ¯
    pub timestamp: String,     // æ—¶é—´æˆ³
}
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨æµç¨‹

1. **è·å–å¯ç”¨ç«¯å£**
```json
{
  "type": "GetPorts"
}
```

2. **é…ç½®å¹¶è¿æ¥**
```json
{
  "type": "Connect",
  "data": {
    "port": "COM1",
    "baud_rate": 115200,
    "data_bits": 8,
    "stop_bits": 1,
    "parity": "None",
    "flow_control": "None"
  }
}
```

3. **å‘é€æ•°æ®**
```json
{
  "type": "SendData",
  "data": {
    "data": [72, 101, 108, 108, 111],
    "format": "Text"
  }
}
```

4. **æ–­å¼€è¿æ¥**
```json
{
  "type": "Disconnect"
}
```

## æ€§èƒ½ç‰¹æ€§

- **å¼‚æ­¥ I/O**: åŸºäº Tokio çš„éé˜»å¡ I/O æ“ä½œ
- **é›¶æ‹·è´**: æœ€å°åŒ–æ•°æ®å¤åˆ¶æ“ä½œ
- **ç¼“å†²ç®¡ç†**: æ™ºèƒ½çš„è¯»å†™ç¼“å†²åŒºç®¡ç†
- **èµ„æºå›æ”¶**: è‡ªåŠ¨çš„èµ„æºæ¸…ç†å’Œå†…å­˜ç®¡ç†

## å¹³å°æ”¯æŒ

- âœ… Windows (COM ç«¯å£)
- âœ… Linux (ttyUSB, ttyACM ç­‰)
- âœ… macOS (cu.* è®¾å¤‡)
- âœ… æ”¯æŒ USB è½¬ä¸²å£è®¾å¤‡

## å¼€å‘å’Œè°ƒè¯•

### å¯ç”¨æ—¥å¿—

```rust
// åœ¨ä¸»ç¨‹åºä¸­åˆå§‹åŒ–æ—¥å¿—
env_logger::init();

// æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
env_logger::Builder::from_env(Env::default().default_filter_or("debug")).init();
```

### æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
cargo test

# è¿è¡Œé›†æˆæµ‹è¯•
cargo test --test integration

# è¿è¡ŒåŸºå‡†æµ‹è¯•
cargo bench
```

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è°ƒè¯•æ—¥å¿—**: è®¾ç½® `RUST_LOG=debug`
2. **ä½¿ç”¨è™šæ‹Ÿä¸²å£**: åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ socat æˆ–ç±»ä¼¼å·¥å…·
3. **æ¨¡æ‹Ÿè®¾å¤‡**: ä½¿ç”¨ä¸²å£æ¨¡æ‹Ÿå™¨è¿›è¡Œæµ‹è¯•

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç¨‹åºä½¿ç”¨è¯¥ç«¯å£
   - ç¡®ä¿ç«¯å£æƒé™æ­£ç¡®

2. **è¿æ¥è¶…æ—¶**
   - æ£€æŸ¥è®¾å¤‡æ˜¯å¦æ­£ç¡®è¿æ¥
   - éªŒè¯é…ç½®å‚æ•°æ˜¯å¦æ­£ç¡®

3. **æ•°æ®ä¹±ç **
   - æ£€æŸ¥æ³¢ç‰¹ç‡è®¾ç½®
   - éªŒè¯æ•°æ®ä½å’Œæ ¡éªŒä½é…ç½®

4. **æƒé™é—®é¢˜ (Linux/macOS)**
   ```bash
   sudo usermod -a -G dialout $USER
   sudo chmod 666 /dev/ttyUSB0
   ```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤ Pull Request å’Œ Issueï¼è¯·ç¡®ä¿ï¼š

1. ä»£ç ç¬¦åˆ Rust é£æ ¼æŒ‡å—
2. æ·»åŠ é€‚å½“çš„æµ‹è¯•
3. æ›´æ–°ç›¸å…³æ–‡æ¡£
4. é€šè¿‡æ‰€æœ‰ CI æ£€æŸ¥

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2025-06-13)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºæœ¬ä¸²å£é€šä¿¡åŠŸèƒ½
- å®Œæ•´çš„ API æ¥å£
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- é…ç½®ç®¡ç†å’Œç»Ÿè®¡ä¿¡æ¯
